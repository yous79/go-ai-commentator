# 囲碁AI解説システム 統合仕様書 (Gemini.md) - Rev. 38.0

## 0. モデル名称・認識に関する絶対規約
(省略)

### 0.4 実行プロセスにおける絶対遵守事項 [NEW]
- **承認の必須性**: 実装、リファクタリング、ファイル操作等の「盤面やコードへの変更」を伴う作業に着手する際は、案を提示した後、**必ずユーザーからの明示的な承認を得ること。**
- **独断実行の禁止**: 「進めてよいか」の確認と同時に実装（ツール呼び出し）を開始することは厳禁とする。必ずターンを分けてユーザーの返答を待つこと。

## 1. ビジョンと絶対目標
(省略)

## 2. 形状検知ロジック：動的・幾何学的・効率性ハイブリッド [REVISED]
形状検知は、静的なパターン照合と、着手の手順を考慮した動的解析のハイブリッド構成とする。

### 2.1 宣言的パターン（静的）
- **データ駆動**: `pattern.json` による幾何学的照合。

### 2.2 動的・手順解析（動的）
- **手順の考慮**: 特定の形状（ポン抜き、ワリコミ等）の検知において、最新の着手がもたらした「盤面の変化（石の増減）」を必須条件とする。
- **時間軸の論理**: 単なる石の配置だけでなく、「その石がいつ打たれ、何が起きたか」という時間軸の文脈を形状定義に組み込む。

### 2.3 主要形状の厳密定義
- **ポン抜き (Ponnuki)**: 最新手によって相手の石がちょうど1つ抜き去られ、かつダイヤモンド型が完成した状態。
- (サカレ形、二目の頭等の定義は継続)

### 2.4 効率性・干渉解析 (Efficiency Analysis) [NEW]
- **カス石干渉 (Kasu-ishi Interference)**: 
    - **定義**: 相手の「死に石（安定度 < 0.0）」に隣接・近接する地点へ着手すること。
    - **論理**: Ownershipが0.8以上（自分側）で確定している領域内の相手石は「取る必要のない石」と定義。これへの干渉を「手数の浪費（緩着）」として検知する。

## 5. 安定度分析：五段階の生存ステータス [REVISED]

Ownershipデータを以下の五段階でラベル付けし、AI解説の優先度とトーンを制御する。

1. **Dead (死に/カス石)**: Stability < 0.0
   - 解釈: 相手の確定地の中にある。救出不可能。
   - 指導方針: 「助ける・守る」の表現を禁止。「捨て石」「活用」を推奨。
2. **Critical (死に体)**: Stability 0.0 - 0.2
   - 解釈: 非常に危険。救援の価値を吟味すべき。
3. **Weak (弱い)**: Stability 0.2 - 0.5
   - 解釈: 攻防の焦点。補強が急場。
4. **Stable (安定)**: Stability 0.5 - 0.8
   - 解釈: ほぼ安全だが、利用される余地がある。
5. **Strong (確定)**: Stability > 0.8
   - 解釈: 完全に活きている。

## 6. AI解説生成：事実先行・人格統合プロトコル [REVISED]
- **確定事実の優先**: 解析データ、形状検知結果（動的な手順を含む）、安定度分析、緊急度データをプロンプト最上部に配置。
- **カス石に関する制約**: 安定度が「Dead」に分類された石について、AIは決して救援を勧めてはならない。もしユーザーが救援を試みた場合は、その非効率性を格言（「逃げるな、捨てよ」等）を用いて厳しく指摘すること。

(以下、第7条以降は継続)