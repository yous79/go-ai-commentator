# 囲碁AI解説システム 統合仕様書 (Gemini.md) - Rev. 3.0

## 0. 最優先原則 (THE ABSOLUTE RULE)
**【解析データ未参照の解説生成は厳禁】**
Geminiは、必ず `consult_katago_tool` を実行し、その返り値（勝率、目数、PV）を直接の根拠として解説しなければならない。
- ツールを呼び出していない回答は、内容に関わらず「不正」とみなす。
- ツールがエラーを返した場合、またはデータが空の場合、Geminiは独自の推測（ハルシネーション）を述べてはならず、正直に「データ不足のため解析不能」と回答を終了しなければならない。

## 1. 開発ミッション
KataGoの正確な「読み」と、Gemini 3の高度な「推論・言語能力」を融合させ、大人の級位者が論理的に納得できる囲碁解説体験を提供する。

## 2. 厳守すべき実装・文法ルール (Anti-Bug Manifesto)
- **1行1命令の徹底**: セミコロン（`;`）による命令結合を全面的に禁止。
- **例外処理の安全性**: `except Exception as e` の `e` は必ず文字列に変換してから使用。
- **インデントの整合性**: 常に標準的なPythonインデントを維持。

## 3. 技術スタック & SDK仕様
- **SDK**: `google-genai` (最新版)。
- **モデル**: `gemini-3-flash-preview` を固定使用。
- **ツール利用**: `mode='AUTO'` または `mode='ANY'` で KataGo 連携を強制。

## 4. 囲碁ロジックの定義 (ハルシネーション防止)
- **勝率の解釈**: `winrate` は常に黒番視点であることをモデルに再三念押しする。
- **根拠の提示**: 座標やPVの具体名を出して解説させる。

## 5. 知識ベース (Knowledge Base) 活用ルール
- 現状または変化図に出現した時のみ言及する「受動的参照」を徹底。無関係な局面での知識披露を禁止。
