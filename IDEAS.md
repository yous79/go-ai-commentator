# 囲碁AI解説システム アイデア・ストック (IDEAS.md)

このファイルは、システムのさらなる進化のための改善案や新機能のアイデアを蓄積・管理するバックログです。

## 1. 視覚的・分析的強化 (Visual & Analytical)
- [ ] **地の勢力可視化 (Ownership Map)**: 盤上の黒地・白地の勢力圏を半透明で可視化し、大局観をサポート。
- [x] **勝率推移グラフの動的表示**: メインUIにmatplotlib等のグラフを埋め込み、形勢の波を一目で把握可能に。
- [ ] **石の強弱スコアリング**: Ownershipデータから「攻められている石」「安定した石」を定量化し、Geminiに事実として注入。

## 2. インタラクティブ・学習 (Interactive Learning)
- [ ] **座標ハイライト連携**: Gemini의 解説文内の座標をクリックすると、盤上の該当位置が点滅・プレビュー。
- [ ] **検討モード勝率比較 (What-if)**: 検討手順を置いた瞬間に、元の局面との勝率差をリアルタイム表示。
- [x] **AI推奨図の連番表示**: PVを表示する際、現在の検討モードの仕組みを流用して石に手順番号を振る。

## 3. レポート機能の高度化 (Advanced Reporting)
- [ ] **「今局の急所」自動選定**: 勝率低下と悪形検知が重なった手を、最重要学習ポイントとしてレポート最上部に配置。
- [ ] **グラフ付きPDF**: 勝率推移グラフを自動生成し、PDFレポートの冒頭に挿入。
- [ ] **HTMLレポート出力**: 画像をインライン表示したリッチなウェブ形式レポートの生成。

## 4. 知識ベース・アルゴリズム (Knowledge & Algorithms)
- [x] **形状検知の拡充**: 「タケフ（竹節）」「一間トビ（効率的な連結）」「団子石（効率の悪い塊）」の追加。
- [ ] **自律的用語学習**: 未定義だがKataGoが重要視する形をGeminiが発見し、仮の名称で解説する仕組み。
- [x] **MCPリソース化**: 知識ベースを `knowledge://` スキーマ経由でフェッチ可能にし、コンテキスト窓を節約。（Rev 17.0で対応済）

## 5. アーキテクチャ・最適化 (Engineering)
- [x] **バッチ解析の並列化**: SGFロード時のバックグラウンド解析を複数スレッド化し、高速化。
- [ ] **セッション管理**: 複数の対局やクライアントからの同時接続を、より厳密に分離・管理。
- [x] **ロギング統合**: 各プロセスのログを `src/utils/logger.py` で一元管理し、トレーサビリティを向上。

## 6. リファクタリング・堅牢化 (Refactoring & Robustness) - Rev 17.0+
- [x] **知識アクセスの抽象化 (Knowledge Repository)**: `src/mcp_server.py` のファイル読み込みロジックを `KnowledgeRepository` クラスに分離し、他コンポーネントからも利用可能にする。 (Rev 20.0 完了)
- [x] **GUIの責務分離 (Observer/ViewModel)**: `app.py` からビジネスロジック（ファイル監視、API同期）を切り出し、Viewは描画のみに専念させる。（Rev 19.0+ 完了）
- [x] **形状検知の単体テスト化 (Unit Testing)**: 正解・反例を網羅した「厳密論理テスト（Strict Logic Tests）」を完備し、コマンド一発で全形状の整合性を検証可能にする。（Rev 24.0 完了）
- [x] **APIクライアントの共通化**: 分散しているHTTPリクエスト処理を `src/api_client.py` に集約し、タイムアウトやリトライを一元管理する。（Rev 19.0+ 完了）

## 7. MCP高度化・リソース基盤 (Advanced MCP & Resources)
- [x] **動的ゲームコンテキスト (`mcp://game/current/sgf`)**: 現在ロードされているSGFのメタデータや着手履歴を即座に返す動的リソースを実装。AIが「今何手目か」をゼロコストで把握。（Rev 18.0で対応済）
- [ ] **リアルタイム解析進捗 (`mcp://analysis/status`)**: KataGoの解析完了率や発見された悪形の概要を返すリソース。AIがユーザーへの応答タイミングを判断する材料にする。
- [x] **知識リソースの構造化 (JSON/Linked Data)**: 知識テキストを構造化し、`importance` や `related_terms` を含む `metadata.json` を導入。 (Rev 23.0 完了)
- [x] **プロンプトテンプレートのMCP化**: Pythonコード内のプロンプトをMCPの `Prompt` 機能へ移行。AIの性格（ペルソナ）や指導方針をコード変更なしで調整可能にする。 (Rev 22.0 完了)
- [x] **コンテキスト連動型リソース (`mcp://game/current/relevant-knowledge`)**: 現在の局面に現れている悪形・手筋の定義のみを動的に集約して提供し、AIのコンテキスト窓を節約。 (Rev 20.0 完了)

## 8. 次世代形状検知エンジン (Next-Gen Shape Logic) - Rev 19.0+
- [x] **宣言的パターン定義 (Declarative Patterns)**: 座標計算を直接書くのではなく、相対座標と状態（自分・敵・空）の定義リストから自動検知する仕組みへ移行。 (Rev 23.0 完了)
- [ ] **盤面パッチ・プロバイダー**: 各Detectorが個別に19x19を走査するのをやめ、一度のスキャンで抽出した「局所パターン」を各戦略に配布して高速化。
- [ ] **知識メタデータの外部化 (JSON)**: 今回確立した「孤立性」や「先制条件」をコードから切り離し、知識ベース側のJSON設定で制御可能にする。
- [x] **座標Value Object (Pointクラス)**: 座標を単なるタプルではなく、`p1 + p2` のように演算可能なクラスとして定義し、計算ミスを型レベルで防止。
- [x] **APIサーキット・ブレーカー**: 通信エラーが連続した際にリクエストを一時遮断し、スレッド累積による「システムが重くなる」現象をインフラ層で防止。 (Rev 24.0 完了)

---
*最終更新: 2026-01-15 (Rev 24.0 Updated)*